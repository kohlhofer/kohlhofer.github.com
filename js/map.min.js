const livedCountries=["840","826","040","276"],visitedCountries=["124","076","850","840","372","826","826","724","250","528","756","380","470","196","300","348","792","246","804","760","586","360","203","352"],travelPath=[{from:"Munich",to:"Chicago"},{from:"Chicago",to:"London"},{from:"London",to:"Salzburg"},{from:"Salzburg",to:"San Francisco"},{from:"San Francisco",to:"Cary"}],visitedCities=[{name:"Vancouver",coordinates:[-123.1207,49.2827]},{name:"St. Louis",coordinates:[-90.1994,38.627]},{name:"Sacramento",coordinates:[-121.4944,38.5816]},{name:"New York",coordinates:[-74.006,40.7128]},{name:"Kitty Hawk",coordinates:[-75.7057,36.0646]},{name:"Chicago",coordinates:[-87.6298,41.8781]},{name:"New Bern",coordinates:[-77.044,35.1085]},{name:"Morehead City",coordinates:[-76.726,34.7229]},{name:"Atlantic Beach",coordinates:[-76.7404,34.699]},{name:"Charlotte",coordinates:[-80.8431,35.2271]},{name:"Milwaukee",coordinates:[-87.9065,43.0389]},{name:"Seattle",coordinates:[-122.3321,47.6062]},{name:"Atlanta",coordinates:[-84.388,33.749]},{name:"Miami",coordinates:[-80.1918,25.7617]},{name:"Orlando",coordinates:[-81.3789,28.5383]},{name:"Raleigh",coordinates:[-78.6382,35.7796]},{name:"Asheville",coordinates:[-82.5515,35.5951]},{name:"Kansas City",coordinates:[-94.5786,39.0997]},{name:"Los Angeles",coordinates:[-118.2437,34.0522]},{name:"Salt Lake City",coordinates:[-111.891,40.7608]},{name:"Gary",coordinates:[-87.3464,41.5934]},{name:"San Francisco",coordinates:[-122.4194,37.7749]},{name:"Washington DC",coordinates:[-77.0369,38.9072]},{name:"Cary",coordinates:[-78.7812,35.7915]},{name:"Rio de Janeiro",coordinates:[-43.1729,-22.9068]},{name:"São Paulo",coordinates:[-46.6333,-23.5505]},{name:"Salvador",coordinates:[-38.5108,-12.9714]},{name:"Belo Horizonte",coordinates:[-43.9542,-19.9167]},{name:"Honolulu",coordinates:[-157.8583,21.3069]},{name:"Kahului",coordinates:[-156.4667,20.8947]},{name:"Dublin",coordinates:[-6.2603,53.3498]},{name:"Belfast",coordinates:[-5.9301,54.5973]},{name:"Derry",coordinates:[-7.3093,54.9966]},{name:"Edinburgh",coordinates:[-3.1883,55.9533]},{name:"Glasgow",coordinates:[-4.2518,55.8642]},{name:"London",coordinates:[-.1276,51.5074]},{name:"Birmingham",coordinates:[-1.8904,52.4862]},{name:"Bristol",coordinates:[-2.5879,51.4545]},{name:"Brighton",coordinates:[-.1372,50.8225]},{name:"St. Thomas",coordinates:[-64.927,18.3434]},{name:"Madrid",coordinates:[-3.7038,40.4168]},{name:"Málaga",coordinates:[-4.4213,36.7213]},{name:"Paris",coordinates:[2.3522,48.8566]},{name:"Marseille",coordinates:[5.3698,43.2965]},{name:"Nice",coordinates:[7.2619,43.7102]},{name:"Rennes",coordinates:[-1.6778,48.1173]},{name:"Mont Saint-Michel",coordinates:[-1.5115,48.6361]},{name:"Amsterdam",coordinates:[4.9041,52.3676]},{name:"Zurich",coordinates:[8.5417,47.3769]},{name:"Geneva",coordinates:[6.1432,46.2044]},{name:"Bern",coordinates:[7.4474,46.948]},{name:"Rome",coordinates:[12.4964,41.9028]},{name:"Milan",coordinates:[9.1859,45.4642]},{name:"Florence",coordinates:[11.2558,43.7696]},{name:"Venice",coordinates:[12.3155,45.4408]},{name:"Naples",coordinates:[14.2471,40.8518]},{name:"Valletta",coordinates:[14.5146,35.8989]},{name:"Athens",coordinates:[23.7275,37.9838]},{name:"Thessaloniki",coordinates:[22.9408,40.6403]},{name:"Corfu Town",coordinates:[19.9219,39.6243]},{name:"Gaios",coordinates:[20.1883,39.1972]},{name:"Lakka",coordinates:[20.1333,39.2167]},{name:"Longos",coordinates:[20.1667,39.2]},{name:"Budapest",coordinates:[19.0402,47.4979]},{name:"Istanbul",coordinates:[28.9784,41.0082]},{name:"Helsinki",coordinates:[24.9384,60.1699]},{name:"Odessa",coordinates:[30.7233,46.4825]},{name:"Damascus",coordinates:[36.2765,33.5138]},{name:"Karachi",coordinates:[67.0099,24.8608]},{name:"Islamabad",coordinates:[73.0479,33.6844]},{name:"Denpasar",coordinates:[115.2126,-8.65]},{name:"Prague",coordinates:[14.4378,50.0755]},{name:"Reykjavik",coordinates:[-21.8174,64.1265]},{name:"Munich",coordinates:[11.582,48.1351]},{name:"Berlin",coordinates:[13.405,52.52]},{name:"Cologne",coordinates:[6.9603,50.9375]},{name:"Frankfurt",coordinates:[8.6821,50.1109]},{name:"Hamburg",coordinates:[9.9937,53.5511]},{name:"Vienna",coordinates:[16.3738,48.2082]},{name:"Salzburg",coordinates:[13.055,47.8095]}];document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("map-container");let t=e.clientWidth,a=e.clientHeight;const o=d3.select("#map-container").append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${t} ${a}`),n=o.append("g"),i=d3.geoMercator().scale((t+a)/7).translate([t/2,a/2]).center([10,51]),r=d3.geoPath().projection(i),s=d3.zoom().scaleExtent([1,8]).on("zoom",e=>{n.attr("transform",e.transform)});o.call(s).call(s.transform,d3.zoomIdentity),Promise.all([d3.json("https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json")]).then(([e])=>{const a=topojson.feature(e,e.objects.countries);n.selectAll("path").data(a.features).enter().append("path").attr("d",r).attr("class",e=>livedCountries.includes(e.id)?"country lived":visitedCountries.includes(e.id)?"country visited":"country").on("mouseover",(e,t)=>{const a=d3.select("#tooltip");let o="";livedCountries.includes(t.id)?o='<div class="tooltip-status lived">Lived here</div>':visitedCountries.includes(t.id)&&(o='<div class="tooltip-status visited">Visited</div>'),a.style("display","block").html(`${t.properties.name}${o}`)}).on("mouseout",()=>{d3.select("#tooltip").style("display","none")});const o=n.append("g").attr("class","travel-arcs"),s=d3.path();let c=!0;const d=n.append("g").attr("class","city-labels"),l=travelPath.reduce((e,t)=>(e.includes(t.from)||e.push(t.from),e.includes(t.to)||e.push(t.to),e),[]);travelPath.forEach((e,t)=>{const a=visitedCities.find(t=>t.name===e.from),o=visitedCities.find(t=>t.name===e.to);if(a&&o){const e=i(a.coordinates),t=i(o.coordinates),n=[(e[0]+t[0])/2,(e[1]+t[1])/2],r=t[0]-e[0],d=t[1]-e[1],l=.4*Math.sqrt(r*r+d*d);c&&(s.moveTo(e[0],e[1]),c=!1),s.quadraticCurveTo(n[0],n[1]-l,t[0],t[1])}});o.append("path").attr("d",s.toString()).attr("class","travel-arc").attr("stroke-dasharray",function(){return this.getTotalLength()}).attr("stroke-dashoffset",function(){return this.getTotalLength()}).transition().duration(4e3).ease(d3.easeLinear).attr("stroke-dashoffset",0),l.forEach((e,a)=>{const o=visitedCities.find(t=>t.name===e);if(!o)return;const n=i(o.coordinates),r=8,s=4,c=30,l=d.append("g").attr("class","city-label-group"),m=l.append("text").attr("class","city-label").text(o.name),h=m.node().getBBox();let u,p;switch(e){case"Munich":u=150,p=-40;break;case"London":u=-70,p=40;break;case"Salzburg":u=190,p=20;break;case"Chicago":u=-40,p=-30;break;case"San Francisco":u=-40,p=-20;break;case"Cary":u=40,p=-10;break;default:u=n[0]<t/2?c:-30,p=25*a-10}m.remove(),l.append("line").attr("class","city-label-line").attr("x1",n[0]).attr("y1",n[1]).attr("x2",n[0]+u).attr("y2",n[1]+p),l.append("rect").attr("class","city-label-bg").attr("x",n[0]+u-(u>0?0:h.width)-r).attr("y",n[1]+p-h.height/2-s).attr("width",h.width+2*r).attr("height",h.height+2*s),l.append("text").attr("class","city-label").text(o.name).attr("x",n[0]+u-(u>0?0:h.width)).attr("y",n[1]+p)}),n.selectAll("circle").data(visitedCities).enter().append("circle").attr("class",e=>"city-point"+(travelPath.some(t=>t.from===e.name||t.to===e.name)?" path-city":"")).attr("cx",e=>i(e.coordinates)[0]).attr("cy",e=>i(e.coordinates)[1]).attr("r",2).on("mouseover",(e,t)=>{d3.select("#tooltip").style("display","block").html(`${t.name}<div class="tooltip-status visited">Visited</div>`)}).on("mouseout",()=>{d3.select("#tooltip").style("display","none")})});window.addEventListener("resize",()=>{t=e.clientWidth,a=e.clientHeight,o.attr("viewBox",`0 0 ${t} ${a}`),i.scale((t+a)/7).translate([t/2,a/2]),n.selectAll("path").attr("d",r),n.selectAll("circle").attr("cx",e=>i(e.coordinates)[0]).attr("cy",e=>i(e.coordinates)[1]);const c=d3.path();let d=!0;travelPath.forEach(e=>{const t=visitedCities.find(t=>t.name===e.from),a=visitedCities.find(t=>t.name===e.to);if(t&&a){const e=i(t.coordinates),o=i(a.coordinates),n=[(e[0]+o[0])/2,(e[1]+o[1])/2],r=o[0]-e[0],s=o[1]-e[1],l=.4*Math.sqrt(r*r+s*s);d&&(c.moveTo(e[0],e[1]),d=!1),c.quadraticCurveTo(n[0],n[1]-l,o[0],o[1])}}),n.select(".travel-arcs path").attr("d",c.toString());travelPath.reduce((e,t)=>(e.includes(t.from)||e.push(t.from),e.includes(t.to)||e.push(t.to),e),[]).forEach((e,a)=>{const o=visitedCities.find(t=>t.name===e);if(!o)return;const r=i(o.coordinates),s=n.select(`.city-label-group:nth-child(${a+1})`),c=8,d=4,l=30;let m,h;switch(e){case"Munich":m=150,h=-40;break;case"London":m=-70,h=40;break;case"Salzburg":m=190,h=20;break;case"Chicago":m=-40,h=-30;break;case"San Francisco":m=-40,h=-20;break;case"Cary":m=40,h=-10;break;default:m=r[0]<t/2?l:-30,h=25*a-10}const u=s.select("text"),p=u.node().getBBox();s.select("line").attr("x1",r[0]).attr("y1",r[1]).attr("x2",r[0]+m).attr("y2",r[1]+h),s.select("rect").attr("x",r[0]+m-(m>0?0:p.width)-c).attr("y",r[1]+h-p.height/2-d).attr("width",p.width+2*c).attr("height",p.height+2*d),u.attr("x",r[0]+m-(m>0?0:p.width)).attr("y",r[1]+h)}),o.call(s.transform,d3.zoomIdentity)})});