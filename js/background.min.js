class ShaderBackground{constructor(){this.canvas=document.createElement("canvas"),this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.zIndex="-1",document.body.prepend(this.canvas),this.gl=this.canvas.getContext("webgl")||this.canvas.getContext("experimental-webgl"),this.gl?(this.generateNewSeed(),this.init()):console.error("WebGL not supported")}generateNewSeed(){this.seed=Math.random()}async init(){const[t,i]=await Promise.all([this.loadShader("shaders/background.vert",this.gl.VERTEX_SHADER),this.loadShader("shaders/background.frag",this.gl.FRAGMENT_SHADER)]);if(this.program=this.gl.createProgram(),this.gl.attachShader(this.program,t),this.gl.attachShader(this.program,i),this.gl.linkProgram(this.program),!this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS))return void console.error("Unable to initialize shader program:",this.gl.getProgramInfoLog(this.program));this.positionLocation=this.gl.getAttribLocation(this.program,"position"),this.uvLocation=this.gl.getAttribLocation(this.program,"uv"),this.timeLocation=this.gl.getUniformLocation(this.program,"u_time"),this.mouseLocation=this.gl.getUniformLocation(this.program,"u_mouse"),this.resolutionLocation=this.gl.getUniformLocation(this.program,"u_resolution"),this.seedLocation=this.gl.getUniformLocation(this.program,"u_seed"),this.setupEventListeners(),this.positionBuffer=this.gl.createBuffer(),this.uvBuffer=this.gl.createBuffer();const e=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]),s=new Float32Array([0,0,1,0,0,1,1,1]);this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,e,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,s,this.gl.STATIC_DRAW),this.startTime=performance.now(),this.render()}setupEventListeners(){this.mouse={x:.5,y:.5},window.addEventListener("mousemove",this.handleMouseMove.bind(this)),window.addEventListener("resize",this.handleResize.bind(this)),window.addEventListener("click",()=>{this.generateNewSeed(),this.startTime=performance.now()}),this.handleResize()}async loadShader(t,i){const e=await fetch(t),s=await e.text(),h=this.gl.createShader(i);return this.gl.shaderSource(h,s),this.gl.compileShader(h),this.gl.getShaderParameter(h,this.gl.COMPILE_STATUS)?h:(console.error("Shader compile error:",this.gl.getShaderInfoLog(h)),this.gl.deleteShader(h),null)}handleMouseMove(t){const i=this.canvas.getBoundingClientRect();this.mouse.x=(t.clientX-i.left)/i.width,this.mouse.y=1-(t.clientY-i.top)/i.height}handleResize(){const t=this.canvas.clientWidth,i=this.canvas.clientHeight;this.canvas.width===t&&this.canvas.height===i||(this.canvas.width=t,this.canvas.height=i,this.gl.viewport(0,0,this.canvas.width,this.canvas.height))}render(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program);const t=.001*(performance.now()-this.startTime);this.gl.uniform1f(this.timeLocation,t),this.gl.uniform1f(this.seedLocation,this.seed),this.gl.uniform2f(this.mouseLocation,this.mouse.x,this.mouse.y),this.gl.uniform2f(this.resolutionLocation,this.canvas.width,this.canvas.height),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.vertexAttribPointer(this.positionLocation,3,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.uvBuffer),this.gl.enableVertexAttribArray(this.uvLocation),this.gl.vertexAttribPointer(this.uvLocation,2,this.gl.FLOAT,!1,0,0),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4),requestAnimationFrame(this.render.bind(this))}}