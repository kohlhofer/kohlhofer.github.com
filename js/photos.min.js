class PhotoGallery{constructor(){this.photos=[],this.currentIndex=0,this.isLoading=!1,this.theme=localStorage.getItem("theme")||"light",this.loadedPhotos=new Set,this.loadThreshold=500,this.scrollTimeout=null,this.isScrolling=!1,this.scrollIndicator=null,this.init()}async init(){this.setupTheme(),await this.loadPhotos(),this.setupEventListeners(),this.renderPhotos(),await this.handleInitialHash(),this.scrollIndicator=document.querySelector(".scroll-indicator")}async handleInitialHash(){const t=window.location.hash.substring(1);if(t){const o=parseInt(t);if(!isNaN(o)&&o>=0&&o<this.photos.length){for(;this.currentIndex<=o;)await this.loadMorePhotos();this.scrollToPhoto(o)}}}updateURL(){const t=this.currentIndex.toString();window.location.hash!==`#${t}`&&(window.location.hash=t)}setupTheme(){document.body.classList.toggle("dark-theme","dark"===this.theme);const t=document.getElementById("theme-toggle");t.innerHTML="dark"===this.theme?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>',t.addEventListener("click",()=>{this.theme="dark"===this.theme?"light":"dark",localStorage.setItem("theme",this.theme),document.body.classList.toggle("dark-theme"),t.innerHTML="dark"===this.theme?'<i class="fas fa-sun"></i>':'<i class="fas fa-moon"></i>'})}async loadPhotos(){try{const t=await fetch("photos/list.json"),o=await t.json();this.photos=o.photos||[],this.sortPhotosByDate()}catch(t){console.error("Error loading photos:",t),this.photos=[]}}sortPhotosByDate(){this.photos.sort((t,o)=>{const e=new Date(t.date);return new Date(o.date)-e})}setupEventListeners(){let t;window.addEventListener("scroll",()=>{this.handleScroll()}),window.addEventListener("keydown",t=>{"ArrowDown"===t.key?this.scrollToNextPhoto():"ArrowUp"===t.key&&this.scrollToPrevPhoto()}),window.addEventListener("resize",()=>{t&&clearTimeout(t),t=setTimeout(()=>{this.snapToNearestPhoto()},100)})}handleScroll(){this.scrollTimeout&&clearTimeout(this.scrollTimeout),this.isScrolling=!0,this.scrollIndicator&&window.scrollY>50&&this.scrollIndicator.classList.add("hidden"),this.checkLoadMore(),this.scrollTimeout=setTimeout(()=>{this.isScrolling=!1,this.snapToNearestPhoto()},150)}snapToNearestPhoto(){const t=document.querySelectorAll(".photo-item"),o=window.innerHeight;window.scrollY;let e=null,s=1/0,i=0;t.forEach((t,h)=>{const n=t.getBoundingClientRect(),r=n.top+n.height/2,l=Math.abs(r-o/2);l<s&&(s=l,e=t,i=h)});if(e&&s<.3*o){const t=e.offsetTop-(o-e.offsetHeight)/2;window.scrollTo({top:t,behavior:"smooth"}),this.currentIndex=i,this.updateURL()}}scrollToNextPhoto(){const t=(this.currentIndex+1)%this.photos.length;this.scrollToPhoto(t)}scrollToPrevPhoto(){const t=(this.currentIndex-1+this.photos.length)%this.photos.length;this.scrollToPhoto(t)}scrollToPhoto(t){const o=document.querySelectorAll(".photo-item");if(o[t]){const e=window.innerHeight,s=o[t].offsetTop-(e-o[t].offsetHeight)/2;window.scrollTo({top:s,behavior:"smooth"}),this.currentIndex=t,this.updateURL()}}checkLoadMore(){const t=window.innerHeight+window.scrollY;document.documentElement.scrollHeight-t<this.loadThreshold&&!this.isLoading&&this.loadMorePhotos()}async loadMorePhotos(){if(this.isLoading||this.currentIndex>=this.photos.length)return;this.isLoading=!0;const t=document.getElementById("photo-container");for(let o=0;o<3&&this.currentIndex<this.photos.length;o++){const o=this.photos[this.currentIndex];if(!this.loadedPhotos.has(o.filename)){const e=document.createElement("div");e.className="photo-item";const s=document.createElement("img");s.src=`photos/${o.filename}`,s.alt=o.title||"Photo";const i=document.createElement("div");i.className="photo-counter",i.textContent=`${this.currentIndex+1}/${this.photos.length}`,e.appendChild(s),e.appendChild(i),t.appendChild(e),this.loadedPhotos.add(o.filename)}this.currentIndex++}return this.isLoading=!1,this.currentIndex<this.photos.length}renderPhotos(){document.getElementById("photo-container").innerHTML="",this.loadedPhotos.clear(),this.currentIndex=0,this.loadMorePhotos()}showNextPhoto(){const t=document.querySelector(".photo-item.active"),o=(this.currentIndex+1)%this.photos.length,e=document.querySelectorAll(".photo-item")[o];t&&e&&(t.classList.remove("active"),e.classList.add("active"),e.style.transform="translateY(0)",this.currentIndex=o,this.updateURL())}showPrevPhoto(){const t=document.querySelector(".photo-item.active"),o=(this.currentIndex-1+this.photos.length)%this.photos.length,e=document.querySelectorAll(".photo-item")[o];t&&e&&(t.classList.remove("active"),e.classList.add("active"),e.style.transform="translateY(0)",this.currentIndex=o,this.updateURL())}showPhoto(t,o="none"){document.querySelectorAll(".photo-item").forEach(t=>{t.classList.remove("active"),t.style.transform="",t.style.opacity=""});const e=document.querySelectorAll(".photo-item")[t];e&&(e.classList.add("active"),this.currentIndex=t,this.updateURL())}}document.addEventListener("DOMContentLoaded",()=>{new PhotoGallery});